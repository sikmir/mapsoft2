#!/bin/bash -efu

# General interface and option tests
# See also getopt module tests

P=${1:-./ms2conv}

. ../test_lib.sh

#################

# map + data (reference will be taken from the map)
#assert "$P test_data_img/20100320wz.zip test_data_img/o37-122.map\
# -o tmp.pdf" "" 0
#assert_diff test_data_mkref/m47-022.map tmp.map


# 6x6 km box
assert "$P test_data_img/20100320wz.zip test_data_img/o37-122.map\
 --map tmp.map -o tmp.pdf\
 --mkref proj --proj SU37 --coords [7362000,6274000,6000,6000] --dpi 100 --scale 1000" "" 0

sed -i '/CreationDate/d; /Producer/d'  tmp.pdf
assert_diff test_data_img/out1.pdf tmp.pdf

# 2x2 km box
assert "$P test_data_img/20100320wz.zip test_data_img/o37-122.map\
 --map tmp.map -o tmp.pdf\
 --mkref proj --proj SU37 --coords [7364000,6276000,2000,2000] --dpi 300" "" 0

sed -i '/CreationDate/d; /Producer/d'  tmp.pdf
assert_diff test_data_img/out2.pdf tmp.pdf

# 2x2 km box - smooth
assert "$P test_data_img/20100320wz.zip test_data_img/o37-122.map\
 --map tmp.map -o tmp.pdf\
 --mkref proj --proj SU37 --coords [7364000,6276000,2000,2000] --dpi 300\
 --map_smooth 1" "" 0

sed -i '/CreationDate/d; /Producer/d'  tmp.pdf
assert_diff test_data_img/out3.pdf tmp.pdf

rm -f tmp.pdf

#################
