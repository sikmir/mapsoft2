<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>mapsoft2 documentation</title>
  <meta name="keywords" content="mapsof2">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body bgcolor="#FFFFFF">



<div align=right>
Язык:
<b>RU</b>
<a href="mapdb.htm">EN</a>
</div>

<a href="index.ru.htm">На главную...</a>


<h2>
  формат файла MapDB
</h2>


<p>MapDB - формат для
хранения векторных карт в mapsoft2. Он представляет из себя директорию с
несколькими базами данных BerkleyDB:

<ul>
<li> mapinfo.db -- информация о карте
<li> objects.db -- информация об объектах
<li> geohash.db -- данные для гео-индексации
<li> labels.db  -- информация о подписях
</ul>

<p>Во многих
случаях используется упаковка данных в стиле RIFF: 4-символьный тэг
("crds", "name" и т.п.), 4-байтовое число - длина данных в байтах,
данные.

<h2>База данных mapinfo.db</h2>

<p>База данных с 4-байтовым целочисленным ключем
для хранения информации о карте. Поддерживаются следующие номера ключей:

<ul>

<li>0. Версия формата MapDB, целое число записанное в виде строки. Сейчас "0".

<li>1. Название карты (строка).

<li>2. Граница карты. Многоугольник с несколькими сегментами (объект
dMultiLine) упакованный в стиле RIFF с тэгом "crds" для каждого
сегмента. Сегмент состоит из пар координат (lon1,lat1,
lon2,lat2,...), Координаты - градусы в системе WGS84, умноженные на 1e7 и
округленные к ближайшему 4-байтовому целому числу. Граница карты
может быть установлена пользователем и иметь любое значение (в частности,
быть пустой).

</ul>

<h2>База данных objects.db</h2>

<p>Информация об объектах. Ключ - ID объекта, значение - структура со
следующими полями:

<ul>

<li>type: 32-битное челое число, тип объекта. Биты 0..13 не используются, биты
14 и 15 используются для классификации объекта
(поддерживаются значения: 0-точка, 1-линия, 2-многоугольник), биты 16..31
(два последних байта) - собственно, тип объекта.
</ul>

<p> Дальнейшие поля необязаельны. Они запакованы в стиле RIFF в произвольном
порядке:

<ul>
<li>Наклон объекта (используется для точек) представленное в виде 4-байтового
целого числа, в единицах 1/1000 градуса. Запаковано с тэгом "angl".

<li>Ориентация объекта (используется для линий)
представленная в виде 4-байтового целого числа 1 - прямая, 2 - обратная,
0 или отсутствует - не определена. Запаковано с тэгом "dir ".

<li>Название объекта (для показа на карте), строка, запакованая с тэгом "name".

<li>Комментарий к объекту, строка, запакованая с тэгом "comm".

<li>Тэги объекта, произвольное число строк, запакованных с
тэгами "tags".

<li>Координаты. Многосегментная линия, закодированная в строку также, как поле границы
карты в базе данных mapinfo.db с тэгами "crds". При обновлении координат объекта
также должна обновляться база геоиндексации.

</ul>

<h2>База данных geohash.db</h2>

<p>База данных для геоиндексации: ключ - строка <a href="https://en.wikipedia.org/wiki/Geohash">Geohash</a>, значение - ID и тип
объекта. Данные должны быть синхронизованы с координатами в базе данных
objects.db.


<h2>База данных labels.db</h2>

<p>База данных для подписей к объектам. Ключ - ID объекта (разрешено дублирование
ключа), значение - структура со следующими полями:

<ul>
<li>...
</ul>



</body>
</html>
